<!DOCTYPE HTML>
<!--
	Editorial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Arnab Rahman Chowdhury</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="../../assets/css/main.css" />
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">
						<div class="inner">

							<!-- Header -->
								<header id="header">
									<ul class="icons">
										<li><a href="https://www.facebook.com/a.r.chowdhury.18/" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
										<li><a href="https://www.instagram.com/chowdhury_arnab_rahman/" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
										<li><a href="https://linkedin.com/in/archowdhury18" class="icon brands fa fa-linkedin"><span class="label">Linkedin</span></a></li>
										<li><a href="https://github.com/chowdhury18" class="icon brands fab fa-github-square"><span class="label">Github</span></a></li>
									</ul>
								</header>

							<!-- Banner -->
								<section>
									<header class="main">
										<h1>RESTful API using Flask and MongoDB</h1>
									</header>

									<span class="image main"><img src="../../images/flaskREST.jpg" alt="" /></span>

									<hr class="major" />
									<h2>Objective</h2>
									<p>
										Create a <b>RESTful API using Flask web developement framwork and MongoDB</b>. <b>Flask</b> is a micro web framework written in Python.
									</p>
									<hr class="major" />
									<h2>Getting started</h2>
									<h3>Prerequisites:</h3>
									<p> It is recommended to create virtual environment for the purpose of seperate project environment and clean code. To create python virtual environment in Linux and Windows platform, please follow the given <a href="https://www.geeksforgeeks.org/creating-python-virtual-environment-windows-linux/"> link</a>.
									<div class="table-wrapper">
										<table>
											<thead>
												<tr>
													<th>Library</th>
													<th>Command</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td>Flask</td>
													<td>pip install flask</td>
												</tr>
												<tr>
													<td>Flask-mongoengine</td>
													<td>pip install flask-mongoengine</td>
												</tr>
												<tr>
													<td>BSON</td>
													<td>pip install bson</td>
												</tr>
											</tbody>
										</table>
									</div>
									<h3>Description</h3>
									<p>This application implements CRUD (create-read-update-delete) operation by HTTP methods (GET, POST, PUT, DELETE). The CRUD operation performs on three schemas (Professor, ResearchGroup and Student). Moreover, the professors can be searched by designation and research group name. Similarly, the students can be searched by research group name. The schemas are given below:</p>
									<h4> Professor </h4>
									<div class="table-wrapper">
										<table>
											<thead>
												<tr>
													<th>Attribute</th>
													<th>Type</th>
													<th>Condition</th>
													<th>Values</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td>name</td>
													<td>string</td>
													<td>required: true</td>
													<td>any valid string</td>
												</tr>
												<tr>
													<td>designation</td>
													<td>string</td>
													<td>required: true</td>
													<td>enum: ['Professor','Associate Professor','Assistant Professor']</td>
												</tr>
												<tr>
													<td>email</td>
													<td>string</td>
													<td>--</td>
													<td>any valid string</td>
												</tr>
												<tr>
													<td>interests</td>
													<td>list</td>
													<td>--</td>
													<td>[any valid string , ..]</td>
												</tr>
												<tr>
													<td>researchGroups</td>
													<td>list of ResearchGroup</td>
													<td>--</td>
													<td>[researchGroupID , ..]</td>
												</tr>
											</tbody>
										</table>
									</div>
									<h4> ResearchGroup </h4>
									<div class="table-wrapper">
										<table>
											<thead>
												<tr>
													<th>Attribute</th>
													<th>Type</th>
													<th>Condition</th>
													<th>Values</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td>name</td>
													<td>string</td>
													<td>required: true</td>
													<td>any valid string</td>
												</tr>
												<tr>
													<td>founder</td>
													<td>Professor</td>
													<td>required: true</td>
													<td>prof_id</td>
												</tr>
												<tr>
													<td>description</td>
													<td>string</td>
													<td>--</td>
													<td>any valid string</td>
												</tr>
											</tbody>
										</table>
									</div>
									<h4> Student </h4>
									<div class="table-wrapper">
										<table>
											<thead>
												<tr>
													<th>Attribute</th>
													<th>Type</th>
													<th>Condition</th>
													<th>Values</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td>name</td>
													<td>string</td>
													<td>required: true</td>
													<td>any valid string</td>
												</tr>
												<tr>
													<td>studentNumber</td>
													<td>string</td>
													<td>required: true</td>
													<td>any valid string</td>
												</tr>
												<tr>
													<td>researchGroups</td>
													<td>list of ResearchGroup</td>
													<td>--</td>
													<td>[researchGroupID , ..]</td>
												</tr>
											</tbody>
										</table>
									</div>
									<p>CRUD operations on the schemas are given below:</p>
									<h4> Professor </h4>
									<div class="table-wrapper">
										<table>
											<thead>
												<tr>
													<th>Request</th>
													<th>Type</th>
													<th>Route</th>
													<th>Request Body</th>
													<th>Response Body</th>
													<th>Status code</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td>CREATE</td>
													<td>POST</td>
													<td>/listProfessor</td>
													<td>Professor</td>
													<td>{ message: 'Professor successfully created', id: <b>prof_id</b> }</td>
													<td>201</td>
												</tr>
												<tr>
													<td>READ</td>
													<td>GET</td>
													<td>/listProfessor/{prof_id}</td>
													<td>--</td>
													<td>Single database object { name: <b>name</b>, email: <b>email</b>, designation: <b>designation</b>, interests: <b>[interest , ..]</b> }</td>
													<td>200</td>
												</tr>
												<tr>
													<td>READ</td>
													<td>GET</td>
													<td>/listProfessors</td>
													<td>designation OR groupName (*)</td>
													<td>Multiple database objects { name: <b>name</b>, email: <b>email</b> }</td>
													<td>200</td>
												</tr>
												<tr>
													<td>UPDATE</td>
													<td>PUT</td>
													<td>/listProfessor/{prof_id}</td>
													<td>Professor</td>
													<td>{ message: 'Professor successfully updated', id: <b>prof_id</b> }</td>
													<td>200</td>
												</tr>
												<tr>
													<td>DELETE</td>
													<td>DELETE</td>
													<td>/listProfessor/{prof_id}</td>
													<td>--</td>
													<td>{ message: 'Professor successfully deleted', id: <b>prof_id</b> }</td>
													<td>200</td>
												</tr>
											</tbody>
										</table>
									</div>
									<p><b>NOTE:</b> (*) For GET requests, use the query string to pass the parameters.</p>
									<h4> ResearchGroup </h4>
									<div class="table-wrapper">
										<table>
											<thead>
												<tr>
													<th>Request</th>
													<th>Type</th>
													<th>Route</th>
													<th>Request Body</th>
													<th>Response Body</th>
													<th>Status code</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td>CREATE</td>
													<td>POST</td>
													<td>/listGroup</td>
													<td>ResearchGroup</td>
													<td>{ message: 'Group successfully created', id: <b>group_id</b> }</td>
													<td>201</td>
												</tr>
												<tr>
													<td>READ</td>
													<td>GET</td>
													<td>/listGroup/{group_id}</td>
													<td>--</td>
													<td>Single database object { id: <b>group_id</b>, name: <b>name</b>, founder: <b>prof_id</b> }</td>
													<td>200</td>
												</tr>
												<tr>
													<td>UPDATE</td>
													<td>PUT</td>
													<td>/listGroup/{group_id}</td>
													<td>ResearchGroup</td>
													<td>{ message: 'Group successfully updated', id: <b>group_id</b> }</td>
													<td>200</td>
												</tr>
												<tr>
													<td>DELETE</td>
													<td>DELETE</td>
													<td>/listGroup/{group_id}</td>
													<td>--</td>
													<td>{ message: 'Group successfully deleted', id: <b>group_id</b> }</td>
													<td>200</td>
												</tr>
											</tbody>
										</table>
									</div>
									<h4> Student </h4>
									<div class="table-wrapper">
										<table>
											<thead>
												<tr>
													<th>Request</th>
													<th>Type</th>
													<th>Route</th>
													<th>Request Body</th>
													<th>Response Body</th>
													<th>Status code</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td>CREATE</td>
													<td>POST</td>
													<td>/listStudent</td>
													<td>Student</td>
													<td>{ message: 'Student successfully created', id: <b>student_id</b> }</td>
													<td>201</td>
												</tr>
												<tr>
													<td>READ</td>
													<td>GET</td>
													<td>/listStudent/{student_id}</td>
													<td>--</td>
													<td>Single database object { name: <b>name</b>, studentNumber: <b>studentNumber</b>, researchGroups: [<b>group_id , ..</b>] }</td>
													<td>200</td>
												</tr>
												<tr>
													<td>READ</td>
													<td>GET</td>
													<td>/listStudents</td>
													<td>groupName (*)</td>
													<td>Multiple database objects { name: <b>name</b>, studentNumber: <b>studentNumber</b> }</td>
													<td>200</td>
												</tr>
												<tr>
													<td>UPDATE</td>
													<td>PUT</td>
													<td>/listStudent/{student_id}</td>
													<td>Student</td>
													<td>{ message: 'Student successfully updated', id: <b>student_id</b> }</td>
													<td>200</td>
												</tr>
												<tr>
													<td>DELETE</td>
													<td>DELETE</td>
													<td>/listStudent/{student_id}</td>
													<td>--</td>
													<td>{ message: 'Student successfully deleted', id: <b>student_id</b> }</td>
													<td>200</td>
												</tr>
											</tbody>
										</table>
									</div>
									<p><b>NOTE:</b> (*) For GET requests, use the query string to pass the parameters.</p>

									<h3>File structure</h3>
									<pre><code>
flaskREST
|- app.py
|__database
	|- db.py
	|- models.py
</code></pre>
									<h3>Database connection</h3>
									<p>First, initialize mongoengine. <i>db.py</i>:</p>
									<pre><code>
from flask_mongoengine import MongoEngine
db = MongoEngine()
def initialize_db(app):
    db.init_app(app)
</code></pre>
									<p>Second, create schemas. <i>models.py</i>: </p>

									<pre><code>
from .db import db
class Professor(db.Document):
    role = {'Professor': 'Professor',
         'Assistant Professor': 'Assistant Professor',
         'Associate Professor': 'Associate Professor'
         }
    name = db.StringField(max_length=20,required=True, unique=True)
    designation = db.StringField(choices=role.keys(),default="Professor",required=True)
    email = db.StringField(max_length=30,unique=True)
    interests = db.ListField(db.StringField())
    researchGroups = db.ListField(db.ReferenceField('ResearchGroup'))
class ResearchGroup(db.Document):
    name = db.StringField(max_length=20,required=True, unique=True)
    founder = db.ReferenceField(Professor,required=True,dbref=False)
    description = db.StringField(max_length=100)
class Student(db.Document):
    name = db.StringField(max_length=20,required=True, unique=True)
    studentNumber = db.StringField(max_length=20,required=True, unique=True)
    researchGroups = db.ListField(db.ReferenceField(ResearchGroup))
</code></pre>
									<h3> CRUD operations on Professor, ResearchGroup and Student schema (app.py)</h3>
									<pre><code>
from flask import Flask, jsonify, request, Response
from database.db import initialize_db
from database.models import Professor, ResearchGroup, Student
import json
from bson.objectid import ObjectId
import os

app = Flask(__name__)

# database config
app.config['MONGODB_SETTINGS'] = {
    'host': 'mongodb://localhost/flask-db'
}
db = initialize_db(app)

# get all professors
@app.route('/listProfessors', methods=['GET'])
def get_all_professors():
    keys = [key for key in request.args.keys()]
    if keys:
        if keys[0] == 'designation':
            value = request.args.get(keys[0])
            if value:
                professors = Professor.objects(designation=value).to_json()
                all_prof = json.loads(professors)
                if all_prof:
                    output = [{'name': str(p['name']), 'email': str(p['email']), 'designation': str(p['designation'])} for p in all_prof]
                    return jsonify(output), 200
                else:
                    output = {'message': 'Invalid designation'}
                    return output, 200
            else:
                output = {'message': 'Params value empty'}
                return output, 200

        elif keys[0] == 'groupName':
            value = request.args.get(keys[0])
            if value:
                groups = ResearchGroup.objects(name=value)
                if groups:
                    group_id = [group.id for group in groups]
                    professors = Professor.objects(researchGroups=group_id[0]).to_json()
                    all_prof = json.loads(professors)
                    output = [{'name': str(p['name']), 'email': str(p['email']), 'designation': str(p['designation'])} for p in all_prof]
                    return jsonify(output), 200
                else:
                    output = {'message': 'Invalid groupName'}
                    return output, 200
            else:
                output = {'message': 'Params value empty'}
                return output, 200
        else:
            output = {'message': 'Incorrect search key'}
            return output, 200
    else:
        professors = Professor.objects().to_json()
        all_prof = json.loads(professors)
        output = [{'name': str(p['name']), 'email': str(p['email']), 'designation': str(p['designation'])} for p in all_prof]
        return jsonify(output), 200

# get, update and delete professor by ID
@app.route('/listProfessor/&lt;prof_id&gt;', methods=['GET','PUT','DELETE'])
def get_professor_by_id(prof_id):
    if request.method == "GET":
        professor = json.loads(Professor.objects().get_or_404(id=prof_id).to_json())
        output = {'name': str(professor['name']), 'email': str(professor['email']), 'designation': str(professor['designation']), 
		'interests': professor['interests']}
        return jsonify(output), 200
    elif request.method == "PUT":
        body = request.get_json()
        keys = body.keys()
        if body and keys:
            if 'researchGroups' in keys:
                for group_id in body['researchGroups']:
                    Professor.objects(id=prof_id).update(push__researchGroups=ObjectId((group_id)))
            if 'name' in keys:
                Professor.objects(id=prof_id).update(set__name=body['name'])
            if 'designation' in keys:
                Professor.objects(id=prof_id).update(set__designation=body['designation'])
            if 'email' in keys:
                Professor.objects(id=prof_id).update(set__email=body['email'])
            if 'interests' in keys:
                for interest in body['interests']:
                    Professor.objects(id=prof_id).update(push__interests=interest)
            output = {'message': 'Professor successfully updated', 'id': str(prof_id)}
        else:
            output = {'message': 'Message body is empty'}
        return output, 200
    
    elif request.method == "DELETE":
        Professor.objects().get(id=prof_id).delete()
        groups = ResearchGroup.objects(founder=prof_id)
        if groups:
            group_ids = [group.id for group in groups]
            ResearchGroup.objects(founder=prof_id).delete()
            for gid in group_ids:
                Professor.objects(researchGroups=ObjectId(gid)).update(pull__researchGroups=ObjectId(gid))            
        output = {'message': 'Professor successfully deleted', 'id': str(prof_id)}
        return output, 200

# post professor
@app.route('/listProfessor', methods=['POST'])
def add_professor():
    body = request.get_json()
    professor = Professor(**body).save()
    prof_id = professor.id
    output = {'message': 'Professor successfully created', 'id': str(prof_id)}
    return output, 201

# get, update and delete group by ID
@app.route('/listGroup/&lt;group_id&gt;', methods=['GET','PUT','DELETE'])
def get_group_by_id(group_id):
    if request.method == "GET":
        group = json.loads(ResearchGroup.objects(id=group_id).get_or_404().to_json())
        output = {'id': str(group_id), 'name': str(group['name']), 'founder': str(group['founder']['$oid'])}
        return jsonify(output), 200
    elif request.method == "PUT":
        body = request.get_json()
        keys = body.keys()
        if body and keys:
            if 'name' in keys:
                ResearchGroup.objects(id=group_id).update(set__name=body['name'])
            if 'founder' in keys:
                prof_ids = [prof.id for prof in Professor.objects()]
                if ObjectId(body['founder']) in prof_ids:
                    ResearchGroup.objects(id=group_id).update(set__founder=ObjectId(body['founder']))
                    Professor.objects(id=body['founder']).update(push__researchGroups=ObjectId(group_id))
                else:
                    output = {'message':'Invalid founder ID'}
                    return output, 404
            if 'description' in keys:
                ResearchGroup.objects(id=group_id).update(set__description=body['description'])
            output = {'message': 'Group successfully updated', 'id': str(group_id)}
        else:
            output = {'message': 'Message body is empty'}
        return output, 200
    elif request.method == "DELETE":
        ResearchGroup.objects().get(id=group_id).delete()
        founder = Professor.objects(researchGroups=group_id)
        if founder:
            Professor.objects(researchGroups=group_id).update(pull__researchGroups=ObjectId(group_id))
        student = Student.objects(researchGroups=group_id)
        if student:
            Student.objects(researchGroups=group_id).update(pull__researchGroups=ObjectId(group_id))
        output = {'message': 'Group successfully deleted', 'id': str(group_id)}
        return output, 200

# post researchGroup
@app.route('/listGroup', methods=['POST'])
def add_group():
    body = request.get_json()
    founder = body['founder']
    group = ResearchGroup(**body).save()
    group_id = group.id
    Professor.objects(id=founder).update_one(push__researchGroups=group_id)
    output = {'message': 'Group successfully created', 'id': str(group_id)}
    return output, 201

# get all students
@app.route('/listStudents', methods=['GET'])
def get_all_student():
    keys = [key for key in request.args.keys()]
    if keys:
        if keys[0] == 'groupName':
            value = request.args.get(keys[0])
            if value:
                groups = ResearchGroup.objects(name=value)
                if groups:
                    group_id = [group.id for group in groups]
                    students = Student.objects(researchGroups=group_id[0]).to_json()
                    all_students = json.loads(students)
                    output = [{'name': str(p['name']), 'studentNumber': str(p['studentNumber'])} for p in all_students]
                    return jsonify(output), 200
                else:
                    output = {'message': 'Invalid groupName'}
                    return output, 200
            else:
                output = {'message': 'Params value empty'}
                return output, 200
        else:
            output = {'message': 'Incorrect search key'}
            return output, 200

# get, update and delete students
@app.route('/listStudent/&lt;student_id&gt;', methods=['GET','PUT','DELETE'])
def get_student_by_id(student_id):
    if request.method == "GET":
        student = json.loads(Student.objects().get_or_404(id=student_id).to_json())
        if student:
            group_ids = [group['$oid'] for group in student['researchGroups']]
            output = {'name': str(student['name']), 'studentNumber': str(student['studentNumber']), 'researchGroups': str(group_ids)}
        else:
            output = {'message': 'Invalid student ID'}
        return output, 200
    elif request.method == "PUT":
        body = request.get_json()
        keys = body.keys()
        if body and keys:
            if 'name' in keys:
                Student.objects(id=student_id).update(set__name=body['name'])
            if 'studentNumber' in keys:
                Student.objects(id=student_id).update(set__studentNumber=body['studentNumber'])
            if 'researchGroups' in keys:
                for group_id in body['researchGroups']:
                    Student.objects(id=student_id).update(push__researchGroups=ObjectId(group_id))
            output = {'message': 'Student successfully updated', 'id': str(student_id)}
        else:
            output = {'message': 'Message body empty'}
        return output, 200
    elif request.method == "DELETE":
        Student.objects.get_or_404(id=student_id).delete()
        output = {'message': 'Student successfully deleted', 'id': str(student_id)}
        return output, 200

# post student
@app.route('/listStudent', methods=['POST'])
def add_student():
    body = request.get_json()
    student = Student(**body).save()
    student_id = student.id
    output = {'message': 'Student successfully created', 'id': str(student_id)}
    return output, 201
</code></pre>

									<p><b>NOTE:</b> In database config section, <i>flask-db</i> represents the name of the database.</p>
									<h3>To start and run the without reloading</h3>
									<pre><code>
FLASK_APP=app.py FLASK_ENV=developement flask run

Terminal output:
* Serving Flask app "app.py" (lazy loading)
* Environment: development
* Debug mode: on
* Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
* Restarting with stat
* Debugger is active!
* Debugger PIN: 188-695-452
</code></pre>
									<p> The server is running on <i>http://localhost:5000</i>. Download (<a href="https://www.postman.com/">postman</a>) OR use command line tool (<a href="https://curl.haxx.se/">curl</a>) to execute the operations. The following <a href="https://www.taniarascia.com/making-api-requests-postman-curl/">link</a> has the instructions to execute CRUD in both postman and curl.</p>
									<p><b>Download code: </b> <a href="https://github.com/chowdhury18/REST-API"> Github </a></p> 
								</section>

						</div>
					</div>

				<!-- Sidebar -->
					<div id="sidebar">
						<div class="inner">
							<!-- Menu -->
								<nav id="menu">
									<header class="major">
										<h2>Menu</h2>
									</header>
									<ul>
										<li><a href="../../index.html">Homepage</a></li>
									</ul>
								</nav>


							<!-- Section -->
								<section>
									<header class="major">
										<h2>Get in touch</h2>
									</header>
									<ul class="contact">
										<li class="icon solid fa-envelope"><a href="mailto: arnab.chowdhury@aalto.fi">arnab.chowdhury@aalto.fi</a></li>
										<li class="icon solid fa-phone">(+358) 442428984</li>
										<li class="icon solid fa-home">Jamerantaival 11 L 235<br />
										02150, ESPOO, Finland</li>
									</ul>
								</section>

							<!-- Footer -->
								<footer id="footer">
									<p class="copyright">&copy; 2020 Arnab Rahman Chowdhury</p>
								</footer>

						</div>
					</div>


		<!-- Scripts -->
			<script src="../../assets/js/jquery.min.js"></script>
			<script src="../../assets/js/browser.min.js"></script>
			<script src="../../assets/js/breakpoints.min.js"></script>
			<script src="../../assets/js/util.js"></script>
			<script src="../../assets/js/main.js"></script>
			<!--<script src="assets/js/jquery.includeHTML.min.js"></script>
			https://github.com/louisho5/jQuery-Include-HTML-File-Plugin 
			<script>
				$(document).ready(function () {
					$("#sidebar-temp").load("sidebar.html");
					$("#header-temp").load("header.html");
				});
			</script>-->
	</body>
</html>